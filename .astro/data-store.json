[["Map",1,2,9,10,351,352,362,363],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.18.0","content-config-digest","aa86e816f10541ba","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://zakitpro.com\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"prefetch\":{\"defaultStrategy\":\"viewport\"},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{\"ps\":\"powershell\",\"ps1\":\"powershell\"},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[],\"actionBodySizeLimit\":1048576},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","articles",["Map",11,12,32,33,124,125,176,177,239,240,303,304],"getting-started-with-powershell",{"id":11,"data":13,"body":27,"filePath":28,"digest":29,"legacyId":30,"deferredRender":31},{"title":14,"description":15,"publishedAt":16,"pillar":17,"difficulty":18,"type":19,"tags":20,"draft":25,"slug":26},"Getting Started with PowerShell","A comprehensive guide for IT professionals to get started with PowerShell scripting and automation.","2026-02-27","scripting","junior","how-to",[21,22,23,24],"powershell","basics","automation","beginner",false,"untitled","# Getting Started with PowerShell\n\nPowerShell is an essential tool for any IT professional. Whether you're managing Windows endpoints, automating Active Directory tasks, or querying Microsoft Graph, PowerShell is the backbone of modern Windows administration.\n\n## Why PowerShell?\n\nAs an IT desktop engineer, you'll encounter PowerShell in various scenarios:\n\n- **Intune/Endpoint Manager** — Device management via Microsoft Graph\n- **Active Directory** — User and group management\n- **Office 365** — Exchange, SharePoint, and Teams administration\n- **Automation** — Scheduled tasks and CI/CD pipelines\n\n## Prerequisites\n\nBefore diving in, ensure you have:\n\n1. Windows 10/11 or Windows Server 2019+\n2. PowerShell 5.1 or higher (7.x recommended)\n3. VS Code with PowerShell extension\n\n## Your First Script\n\nLet's create a simple script to gather system information:\n\n```powershell\n# Get-SystemInfo.ps1\n# System Information Gatherer\n\n$ComputerInfo = @{\n    ComputerName = $env:COMPUTERNAME\n    OS = (Get-CimInstance -ClassName Win32_OperatingSystem).Caption\n    Version = (Get-CimInstance -ClassName Win32_OperatingSystem).Version\n    LastBoot = (Get-CimInstance -ClassName Win32_OperatingSystem).LastBootUpTime\n    Uptime = ((Get-Date) - (Get-CimInstance -ClassName Win32_OperatingSystem).LastBootUpTime).ToString()\n}\n\n$ComputerInfo | ConvertTo-Json\n```\n\n### Running the Script\n\nSave the code above as `Get-SystemInfo.ps1` and run:\n\n```powershell\n.\\Get-SystemInfo.ps1\n```\n\n## Understanding the Pipeline\n\nOne of PowerShell's most powerful features is the pipeline:\n\n```powershell\n# Get all processes using more than 100MB of memory\nGet-Process | \n    Where-Object { $_.WorkingSet64 -gt 100MB } | \n    Sort-Object WorkingSet64 -Descending | \n    Select-Object -First 10 Name, @{N='MemoryMB';E={[math]::Round($_.WorkingSet64/1MB,2)}}\n```\n\n## Working with Objects\n\nEverything in PowerShell is an object. This makes it incredibly powerful:\n\n```powershell\n# Get the current date as an object\nGet-Date\n\n# Access properties\n(Get-Date).DayOfWeek\n\n# Call methods\n(Get-Date).AddDays(7)\n```\n\n## Best Practices\n\n1. **Always use -WhatIf** for destructive operations\n2. **Use strict mode** with `Set-StrictMode -Version Latest`\n3. **Comment your code** — Future you will thank present you\n4. **Use verbs from the approved list** — Get, Set, New, Remove, etc.\n\n## Next Steps\n\nIn future articles, we'll cover:\n\n- Working with APIs (REST endpoints)\n- Graph API authentication\n- Building modular scripts\n- Error handling\n- Creating scheduled tasks\n\nStay tuned!\n\n```powershell\n# Quick test - run this to verify PowerShell is working\nWrite-Host \"PowerShell is working!\" -ForegroundColor Green\n```","src/content/articles/getting-started-with-powershell.mdx","1d0806e79f403e6b","getting-started-with-powershell.mdx",true,"intune-access-denied-fix",{"id":32,"data":34,"body":44,"filePath":45,"digest":46,"rendered":47,"legacyId":123},{"title":35,"description":36,"publishedAt":16,"pillar":37,"difficulty":38,"type":19,"tags":39,"draft":25,"slug":26},"Fix Intune 0x80070005 Access Denied Error","Troubleshoot and fix the common Intune MDM error 0x80070005 Access Denied when writing to registry or applying policies.","troubleshooting","mid",[40,41,37,42,43],"intune","error-code","mdm","access-denied","# Fix Intune 0x80070005 Access Denied Error\n\nThe dreaded 0x80070005 Access Denied error in Intune is one of the most common issues IT admins face. Here's how to diagnose and fix it.\n\n## The Error\n\nWhen an Intune policy fails, you might see:\n- **Error Code:** 0x80070005\n- **Message:** Access Denied\n- **Context:** Usually when writing to registry or applying policies\n\n## Common Causes\n\n### Cause 1: Insufficient Permissions\nThe device lacks admin rights to modify the target location.\n\n### Cause 2: Protected Registry Keys\nSome registry keys are protected and require elevated privileges.\n\n### Cause 3: Antivirus Blocking\nSecurity software might block registry writes.\n\n### Cause 4: Intune Service Account Issues\nThe MDM service doesn't have proper permissions.\n\n## Troubleshooting Steps\n\n### Step 1: Check Event Viewer\n\nOpen **Event Viewer** and look at:\n- **Applications and Services Logs → Microsoft → Windows → DeviceManagement-Enterprise-Diagnostics-Provider**\n\nLook for:\n- Policy ID\n- Error code\n- Target path\n\n### Step 2: Run Diagnostic Script\n\n```powershell\n# Get Intune policy errors\nGet-WinEvent -FilterHashtable @{\n    LogName = 'Microsoft-Windows-DeviceManagement-Enterprise-Diagnostics-Provider/Operational'\n    Level = 2\n} -MaxEvents 50 | \n    Where-Object { $_.Message -match '0x80070005' } |\n    Select-Object TimeCreated, Message\n```\n\n### Step 3: Check Registry Permissions\n\n```powershell\n# Check if key is protected\n$keyPath = \"HKLM:\\SOFTWARE\\YourTargetKey\"\n$acl = Get-Acl $keyPath\n$acl.Access | Select-Object IdentityReference, RegistryRights\n```\n\n## Solutions\n\n### Solution 1: Run as System (For Scripts)\n\nIn Intune PowerShell scripts, ensure you run in System context:\n\n```powershell\n# In your remediation script\n$scriptPath = \"$env:TEMP\\YourScript.ps1\"\n\n# Execute as SYSTEM\nStart-Process -FilePath \"powershell.exe\" -ArgumentList \"-ExecutionPolicy Bypass -File $scriptPath\" -Verb RunAsSystem -Wait\n```\n\n### Solution 2: Use Proactive Remediations\n\nDeploy a detection + remediation package:\n\n**Detection:**\n```powershell\n# Check if registry key exists and is writable\ntry {\n    $testKey = \"HKLM:\\SOFTWARE\\TestKey\"\n    New-Item -Path $testKey -Force | Out-Null\n    Remove-Item $testKey -Force\n    exit 0  # Writable\n} catch {\n    exit 1  # Not writable\n}\n```\n\n**Remediation:**\n```powershell\n# Grant permissions\n$keyPath = \"HKLM:\\SOFTWARE\\YourKey\"\n$identity = \"NT AUTHORITY\\SYSTEM\"\n$rights = \"FullControl\"\n\n$acl = Get-Acl $keyPath\n$rule = New-Object System.Security.AccessControl.RegistryAccessRule($identity, $rights, \"Allow\")\n$acl.SetAccessRule($rule)\nSet-Acl -Path $keyPath -AclObject $acl\n```\n\n### Solution 3: Exclude from Antivirus\n\nAdd these paths to Windows Defender exclusions:\n- `%ProgramData%\\Microsoft\\Intune*`\n- `%WinDir%\\System32\\Configuration*`\n\n### Solution 4: Check User Rights\n\nEnsure the device has proper user rights:\n1. Open **Local Security Policy**\n2. Check **User Rights Assignment**\n3. Ensure users have **Access this computer from the network**\n\n## Prevention\n\n### Best Practice 1: Test First\nDeploy to pilot group before broad rollout.\n\n### Best Practice 2: Use Detection Scripts\nAlways include detection logic in your packages.\n\n### Best Practice 3: Document Known Issues\nKeep a log of what causes this error in your environment.\n\n## Summary\n\n| Cause | Fix |\n|-------|-----|\n| Insufficient permissions | Run as System |\n| Protected keys | Grant ACL permissions |\n| Antivirus | Add exclusions |\n| Service account | Check MDM permissions |\n\n---\n\n**Tags:** #Intune #Troubleshooting #ErrorCode #ITPro #MDM","src/content/articles/intune-access-denied-fix.md","34a1483b3a6e6b20",{"html":48,"metadata":49},"\u003Ch1 id=\"fix-intune-0x80070005-access-denied-error\">Fix Intune 0x80070005 Access Denied Error\u003C/h1>\n\u003Cp>The dreaded 0x80070005 Access Denied error in Intune is one of the most common issues IT admins face. Here’s how to diagnose and fix it.\u003C/p>\n\u003Ch2 id=\"the-error\">The Error\u003C/h2>\n\u003Cp>When an Intune policy fails, you might see:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Error Code:\u003C/strong> 0x80070005\u003C/li>\n\u003Cli>\u003Cstrong>Message:\u003C/strong> Access Denied\u003C/li>\n\u003Cli>\u003Cstrong>Context:\u003C/strong> Usually when writing to registry or applying policies\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"common-causes\">Common Causes\u003C/h2>\n\u003Ch3 id=\"cause-1-insufficient-permissions\">Cause 1: Insufficient Permissions\u003C/h3>\n\u003Cp>The device lacks admin rights to modify the target location.\u003C/p>\n\u003Ch3 id=\"cause-2-protected-registry-keys\">Cause 2: Protected Registry Keys\u003C/h3>\n\u003Cp>Some registry keys are protected and require elevated privileges.\u003C/p>\n\u003Ch3 id=\"cause-3-antivirus-blocking\">Cause 3: Antivirus Blocking\u003C/h3>\n\u003Cp>Security software might block registry writes.\u003C/p>\n\u003Ch3 id=\"cause-4-intune-service-account-issues\">Cause 4: Intune Service Account Issues\u003C/h3>\n\u003Cp>The MDM service doesn’t have proper permissions.\u003C/p>\n\u003Ch2 id=\"troubleshooting-steps\">Troubleshooting Steps\u003C/h2>\n\u003Ch3 id=\"step-1-check-event-viewer\">Step 1: Check Event Viewer\u003C/h3>\n\u003Cp>Open \u003Cstrong>Event Viewer\u003C/strong> and look at:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Applications and Services Logs → Microsoft → Windows → DeviceManagement-Enterprise-Diagnostics-Provider\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Cp>Look for:\u003C/p>\n\u003Cul>\n\u003Cli>Policy ID\u003C/li>\n\u003Cli>Error code\u003C/li>\n\u003Cli>Target path\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"step-2-run-diagnostic-script\">Step 2: Run Diagnostic Script\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Get Intune policy errors\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Get-WinEvent\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">FilterHashtable \u003C/span>\u003Cspan style=\"color:#F97583\">@\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    LogName \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'Microsoft-Windows-DeviceManagement-Enterprise-Diagnostics-Provider/Operational'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    Level \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">MaxEvents \u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Where-Object\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#79B8FF\">$_\u003C/span>\u003Cspan style=\"color:#E1E4E8\">.Message \u003C/span>\u003Cspan style=\"color:#F97583\">-match\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> '0x80070005'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> } \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Select-Object\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> TimeCreated\u003C/span>\u003Cspan style=\"color:#F97583\">,\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Message\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-3-check-registry-permissions\">Step 3: Check Registry Permissions\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Check if key is protected\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$keyPath \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"HKLM:\\SOFTWARE\\YourTargetKey\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$acl \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Get-Acl\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $keyPath\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$acl.Access \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Select-Object\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> IdentityReference\u003C/span>\u003Cspan style=\"color:#F97583\">,\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> RegistryRights\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"solutions\">Solutions\u003C/h2>\n\u003Ch3 id=\"solution-1-run-as-system-for-scripts\">Solution 1: Run as System (For Scripts)\u003C/h3>\n\u003Cp>In Intune PowerShell scripts, ensure you run in System context:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># In your remediation script\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$scriptPath \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">$\u003C/span>\u003Cspan style=\"color:#79B8FF\">env:\u003C/span>\u003Cspan style=\"color:#E1E4E8\">TEMP\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\YourScript.ps1\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Execute as SYSTEM\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Start-Process\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">FilePath \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"powershell.exe\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">ArgumentList \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"-ExecutionPolicy Bypass -File \u003C/span>\u003Cspan style=\"color:#E1E4E8\">$scriptPath\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Verb RunAsSystem \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Wait\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"solution-2-use-proactive-remediations\">Solution 2: Use Proactive Remediations\u003C/h3>\n\u003Cp>Deploy a detection + remediation package:\u003C/p>\n\u003Cp>\u003Cstrong>Detection:\u003C/strong>\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Check if registry key exists and is writable\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">try\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    $testKey \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"HKLM:\\SOFTWARE\\TestKey\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    New-Item\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Path $testKey \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Force \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Out-Null\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Remove-Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $testKey \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Force\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#6A737D\">  # Writable\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">catch\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#6A737D\">  # Not writable\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>Remediation:\u003C/strong>\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Grant permissions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$keyPath \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"HKLM:\\SOFTWARE\\YourKey\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$identity \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"NT AUTHORITY\\SYSTEM\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$rights \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"FullControl\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$acl \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Get-Acl\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $keyPath\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$rule \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> New-Object\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> System.Security.AccessControl.RegistryAccessRule($identity\u003C/span>\u003Cspan style=\"color:#F97583\">,\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $rights\u003C/span>\u003Cspan style=\"color:#F97583\">,\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Allow\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$acl.SetAccessRule($rule)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Set-Acl\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Path $keyPath \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">AclObject $acl\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"solution-3-exclude-from-antivirus\">Solution 3: Exclude from Antivirus\u003C/h3>\n\u003Cp>Add these paths to Windows Defender exclusions:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>%ProgramData%\\Microsoft\\Intune*\u003C/code>\u003C/li>\n\u003Cli>\u003Ccode>%WinDir%\\System32\\Configuration*\u003C/code>\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"solution-4-check-user-rights\">Solution 4: Check User Rights\u003C/h3>\n\u003Cp>Ensure the device has proper user rights:\u003C/p>\n\u003Col>\n\u003Cli>Open \u003Cstrong>Local Security Policy\u003C/strong>\u003C/li>\n\u003Cli>Check \u003Cstrong>User Rights Assignment\u003C/strong>\u003C/li>\n\u003Cli>Ensure users have \u003Cstrong>Access this computer from the network\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"prevention\">Prevention\u003C/h2>\n\u003Ch3 id=\"best-practice-1-test-first\">Best Practice 1: Test First\u003C/h3>\n\u003Cp>Deploy to pilot group before broad rollout.\u003C/p>\n\u003Ch3 id=\"best-practice-2-use-detection-scripts\">Best Practice 2: Use Detection Scripts\u003C/h3>\n\u003Cp>Always include detection logic in your packages.\u003C/p>\n\u003Ch3 id=\"best-practice-3-document-known-issues\">Best Practice 3: Document Known Issues\u003C/h3>\n\u003Cp>Keep a log of what causes this error in your environment.\u003C/p>\n\u003Ch2 id=\"summary\">Summary\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Cause\u003C/th>\u003Cth>Fix\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Insufficient permissions\u003C/td>\u003Ctd>Run as System\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Protected keys\u003C/td>\u003Ctd>Grant ACL permissions\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Antivirus\u003C/td>\u003Ctd>Add exclusions\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Service account\u003C/td>\u003Ctd>Check MDM permissions\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Cp>\u003Cstrong>Tags:\u003C/strong> #Intune #Troubleshooting #ErrorCode #ITPro #MDM\u003C/p>",{"headings":50,"localImagePaths":116,"remoteImagePaths":117,"frontmatter":118,"imagePaths":122},[51,54,58,61,65,68,71,74,77,80,83,86,89,92,95,98,101,104,107,110,113],{"depth":52,"slug":53,"text":35},1,"fix-intune-0x80070005-access-denied-error",{"depth":55,"slug":56,"text":57},2,"the-error","The Error",{"depth":55,"slug":59,"text":60},"common-causes","Common Causes",{"depth":62,"slug":63,"text":64},3,"cause-1-insufficient-permissions","Cause 1: Insufficient Permissions",{"depth":62,"slug":66,"text":67},"cause-2-protected-registry-keys","Cause 2: Protected Registry Keys",{"depth":62,"slug":69,"text":70},"cause-3-antivirus-blocking","Cause 3: Antivirus Blocking",{"depth":62,"slug":72,"text":73},"cause-4-intune-service-account-issues","Cause 4: Intune Service Account Issues",{"depth":55,"slug":75,"text":76},"troubleshooting-steps","Troubleshooting Steps",{"depth":62,"slug":78,"text":79},"step-1-check-event-viewer","Step 1: Check Event Viewer",{"depth":62,"slug":81,"text":82},"step-2-run-diagnostic-script","Step 2: Run Diagnostic Script",{"depth":62,"slug":84,"text":85},"step-3-check-registry-permissions","Step 3: Check Registry Permissions",{"depth":55,"slug":87,"text":88},"solutions","Solutions",{"depth":62,"slug":90,"text":91},"solution-1-run-as-system-for-scripts","Solution 1: Run as System (For Scripts)",{"depth":62,"slug":93,"text":94},"solution-2-use-proactive-remediations","Solution 2: Use Proactive Remediations",{"depth":62,"slug":96,"text":97},"solution-3-exclude-from-antivirus","Solution 3: Exclude from Antivirus",{"depth":62,"slug":99,"text":100},"solution-4-check-user-rights","Solution 4: Check User Rights",{"depth":55,"slug":102,"text":103},"prevention","Prevention",{"depth":62,"slug":105,"text":106},"best-practice-1-test-first","Best Practice 1: Test First",{"depth":62,"slug":108,"text":109},"best-practice-2-use-detection-scripts","Best Practice 2: Use Detection Scripts",{"depth":62,"slug":111,"text":112},"best-practice-3-document-known-issues","Best Practice 3: Document Known Issues",{"depth":55,"slug":114,"text":115},"summary","Summary",[],[],{"title":35,"description":36,"pillar":37,"type":19,"tags":119,"difficulty":38,"publishedAt":16,"author":120,"heroImage":121,"featured":25},[40,41,37,42,43],"zakmint","/images/access-denied.png",[],"intune-access-denied-fix.md","intune-stuck-sync-fixer",{"id":124,"data":126,"body":133,"filePath":134,"digest":135,"rendered":136,"legacyId":175},{"title":127,"description":128,"publishedAt":16,"pillar":37,"difficulty":38,"type":19,"tags":129,"draft":25,"slug":26},"Fix Stuck Intune Sync: The Ultimate PowerShell Solution","Learn how to detect and automatically fix stuck Intune Management Extension sync issues using Proactive Remediations and PowerShell scripts.",[40,21,130,131,132],"endpoint-manager","sync-issues","proactive-remediation","# Fix Stuck Intune Sync: The Ultimate PowerShell Solution\n\nIntune doesn't always fail loudly. Sometimes it just... stops syncing. Over the years, I've seen countless Intune issues where policies don't apply, scripts never execute, and devices look \"compliant\" but aren't actually checking in.\n\nThe root cause? **Stuck Intune Management Extension (IME) sync — silently.**\n\nIn this guide, I'll show you how to detect and automatically fix this issue using Proactive Remediations.\n\n## The Problem\n\nWhen the Intune Management Extension stops syncing, you might see:\n- Policies show as \"Applied\" but nothing happens\n- Scripts never run\n- Device compliance is stuck\n- Software installations fail silently\n\nThe worst part? **Intune shows everything looks fine** while your devices are essentially orphaned.\n\n## The Solution: Proactive Remediations\n\nWe'll create a two-part solution:\n1. **Detection Script** - Checks if sync is stuck\n2. **Remediation Script** - Fixes the issue automatically\n\n### Step 1: Create the Detection Script\n\nSave this as `Detect-Intune-StuckSync.ps1`:\n\n```powershell\n$ErrorActionPreference = 'SilentlyContinue'\n\n# Check last successful sync time\n$SyncTime = (Get-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\EnterpriseManagement\\ MDM\\ MDMApp\" -Name \"LastSyncTime\" -ErrorAction SilentlyContinue).LastSyncTime\n\nif (-not $SyncTime) {\n    Write-Output \"No sync history found\"\n    exit 1\n}\n\n$TimeSinceSync = (Get-Date) - $SyncTime\n\n# If more than 24 hours since last sync, flag as stale\nif ($TimeSinceSync.TotalHours -gt 24) {\n    Write-Output \"Stale: Last sync was $($TimeSinceSync.Hours) hours ago\"\n    exit 1\n}\n\nWrite-Output \"Healthy: Last sync was $($TimeSinceSync.Minutes) minutes ago\"\nexit 0\n```\n\n### Step 2: Create the Remediation Script\n\nSave this as `Remediate-Intune-StuckSync.ps1`:\n\n```powershell\n# Restart Intune Management Extension service\nRestart-Service -Name \"IntuneManagementExtension\" -Force\n\n# Wait for service to start\nStart-Sleep -Seconds 5\n\n# Trigger sync via scheduled task\nGet-ScheduledTask -TaskPath \"\\Microsoft\\Intune\\*\" -ErrorAction SilentlyContinue | \n    Where-Object { $_.State -ne \"Ready\" } | \n    Start-ScheduledTask\n\nWrite-Output \"Intune sync triggered successfully\"\n```\n\n### Step 3: Deploy in Intune\n\n1. Open **Microsoft Intune admin center**\n2. Navigate to **Reports → Endpoint analytics → Proactive remediations**\n3. Click **+ Create script package**\n4. Upload both scripts\n5. Configure settings:\n   - Run script using logged-on credentials: **No**\n   - Enforce script signature check: **No**\n   - Run script in 64-bit PowerShell: **Yes**\n6. Assign to your pilot group first\n7. Schedule to run every 6-12 hours\n\n### Step 4: Validate\n\nAfter deployment, monitor in:\n- **Reports → Endpoint analytics → Proactive remediations**\n- Check detection status and remediation success\n\n## Optional: Log Analytics Integration\n\nTo get detailed logging, add your Log Analytics workspace:\n\n```powershell\n$WorkspaceId = \"your-workspace-id\"\n$SharedKey = \"your-shared-key\"\n\n# Function to send log to Log Analytics\nfunction Send-LogAnalytics {\n    param([string]$Message, [string]$Level)\n    \n    $Body = @{\n        ComputerName = $env:COMPUTERNAME\n        TimeGenerated = (Get-Date -Format \"o\")\n        Message = $Message\n        Level = $Level\n    } | ConvertTo-Json\n    \n    # Send to Log Analytics...\n}\n```\n\n## User Experience\n\nWhen the remediation runs, users will see a non-intrusive toast notification:\n- ✅ No interruption to their work\n- ✅ Builds trust in IT monitoring\n- ✅ Reduces support tickets\n\n## Conclusion\n\nThis solution automatically detects and fixes stuck Intune sync issues before they become problems. Your devices stay healthy, compliant, and properly managed — without manual intervention.\n\nWant me to share the complete GitHub repository with all scripts? Let me know in the comments!\n\n---\n\n**Tags:** #Intune #PowerShell #EndpointManager #ProactiveRemediation #ITPro","src/content/articles/intune-stuck-sync-fixer.md","eae2ccf9a5d2d621",{"html":137,"metadata":138},"\u003Ch1 id=\"fix-stuck-intune-sync-the-ultimate-powershell-solution\">Fix Stuck Intune Sync: The Ultimate PowerShell Solution\u003C/h1>\n\u003Cp>Intune doesn’t always fail loudly. Sometimes it just… stops syncing. Over the years, I’ve seen countless Intune issues where policies don’t apply, scripts never execute, and devices look “compliant” but aren’t actually checking in.\u003C/p>\n\u003Cp>The root cause? \u003Cstrong>Stuck Intune Management Extension (IME) sync — silently.\u003C/strong>\u003C/p>\n\u003Cp>In this guide, I’ll show you how to detect and automatically fix this issue using Proactive Remediations.\u003C/p>\n\u003Ch2 id=\"the-problem\">The Problem\u003C/h2>\n\u003Cp>When the Intune Management Extension stops syncing, you might see:\u003C/p>\n\u003Cul>\n\u003Cli>Policies show as “Applied” but nothing happens\u003C/li>\n\u003Cli>Scripts never run\u003C/li>\n\u003Cli>Device compliance is stuck\u003C/li>\n\u003Cli>Software installations fail silently\u003C/li>\n\u003C/ul>\n\u003Cp>The worst part? \u003Cstrong>Intune shows everything looks fine\u003C/strong> while your devices are essentially orphaned.\u003C/p>\n\u003Ch2 id=\"the-solution-proactive-remediations\">The Solution: Proactive Remediations\u003C/h2>\n\u003Cp>We’ll create a two-part solution:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Detection Script\u003C/strong> - Checks if sync is stuck\u003C/li>\n\u003Cli>\u003Cstrong>Remediation Script\u003C/strong> - Fixes the issue automatically\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"step-1-create-the-detection-script\">Step 1: Create the Detection Script\u003C/h3>\n\u003Cp>Save this as \u003Ccode>Detect-Intune-StuckSync.ps1\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">$ErrorActionPreference\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'SilentlyContinue'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Check last successful sync time\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$SyncTime \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Get-ItemProperty\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Path \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"HKLM:\\SOFTWARE\\Microsoft\\EnterpriseManagement\\ MDM\\ MDMApp\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Name \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"LastSyncTime\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">ErrorAction SilentlyContinue).LastSyncTime\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#F97583\">-not\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $SyncTime) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"No sync history found\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$TimeSinceSync \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Get-Date\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $SyncTime\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># If more than 24 hours since last sync, flag as stale\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ($TimeSinceSync.TotalHours \u003C/span>\u003Cspan style=\"color:#F97583\">-gt\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 24\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Stale: Last sync was \u003C/span>\u003Cspan style=\"color:#F97583\">$\u003C/span>\u003Cspan style=\"color:#9ECBFF\">(\u003C/span>\u003Cspan style=\"color:#E1E4E8\">$TimeSinceSync.Hours\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> hours ago\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Healthy: Last sync was \u003C/span>\u003Cspan style=\"color:#F97583\">$\u003C/span>\u003Cspan style=\"color:#9ECBFF\">(\u003C/span>\u003Cspan style=\"color:#E1E4E8\">$TimeSinceSync.Minutes\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> minutes ago\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-2-create-the-remediation-script\">Step 2: Create the Remediation Script\u003C/h3>\n\u003Cp>Save this as \u003Ccode>Remediate-Intune-StuckSync.ps1\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Restart Intune Management Extension service\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Restart-Service\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Name \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"IntuneManagementExtension\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Force\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Wait for service to start\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Start-Sleep\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Seconds \u003C/span>\u003Cspan style=\"color:#79B8FF\">5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Trigger sync via scheduled task\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Get-ScheduledTask\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">TaskPath \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\\Microsoft\\Intune\\*\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">ErrorAction SilentlyContinue \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Where-Object\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#79B8FF\">$_\u003C/span>\u003Cspan style=\"color:#E1E4E8\">.State \u003C/span>\u003Cspan style=\"color:#F97583\">-ne\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Ready\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> } \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Start-ScheduledTask\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Intune sync triggered successfully\"\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-3-deploy-in-intune\">Step 3: Deploy in Intune\u003C/h3>\n\u003Col>\n\u003Cli>Open \u003Cstrong>Microsoft Intune admin center\u003C/strong>\u003C/li>\n\u003Cli>Navigate to \u003Cstrong>Reports → Endpoint analytics → Proactive remediations\u003C/strong>\u003C/li>\n\u003Cli>Click \u003Cstrong>+ Create script package\u003C/strong>\u003C/li>\n\u003Cli>Upload both scripts\u003C/li>\n\u003Cli>Configure settings:\n\u003Cul>\n\u003Cli>Run script using logged-on credentials: \u003Cstrong>No\u003C/strong>\u003C/li>\n\u003Cli>Enforce script signature check: \u003Cstrong>No\u003C/strong>\u003C/li>\n\u003Cli>Run script in 64-bit PowerShell: \u003Cstrong>Yes\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003C/li>\n\u003Cli>Assign to your pilot group first\u003C/li>\n\u003Cli>Schedule to run every 6-12 hours\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"step-4-validate\">Step 4: Validate\u003C/h3>\n\u003Cp>After deployment, monitor in:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Reports → Endpoint analytics → Proactive remediations\u003C/strong>\u003C/li>\n\u003Cli>Check detection status and remediation success\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"optional-log-analytics-integration\">Optional: Log Analytics Integration\u003C/h2>\n\u003Cp>To get detailed logging, add your Log Analytics workspace:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$WorkspaceId \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"your-workspace-id\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$SharedKey \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"your-shared-key\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Function to send log to Log Analytics\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> Send-LogAnalytics\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    param\u003C/span>\u003Cspan style=\"color:#E1E4E8\">([\u003C/span>\u003Cspan style=\"color:#F97583\">string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">]$Message\u003C/span>\u003Cspan style=\"color:#F97583\">,\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> [\u003C/span>\u003Cspan style=\"color:#F97583\">string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">]$Level)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    $Body \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#F97583\"> @\u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        ComputerName \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $\u003C/span>\u003Cspan style=\"color:#79B8FF\">env:\u003C/span>\u003Cspan style=\"color:#E1E4E8\">COMPUTERNAME\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        TimeGenerated \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Get-Date\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Format \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"o\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        Message \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $Message\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        Level \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $Level\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    } \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#79B8FF\"> ConvertTo-Json\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    # Send to Log Analytics...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"user-experience\">User Experience\u003C/h2>\n\u003Cp>When the remediation runs, users will see a non-intrusive toast notification:\u003C/p>\n\u003Cul>\n\u003Cli>✅ No interruption to their work\u003C/li>\n\u003Cli>✅ Builds trust in IT monitoring\u003C/li>\n\u003Cli>✅ Reduces support tickets\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>This solution automatically detects and fixes stuck Intune sync issues before they become problems. Your devices stay healthy, compliant, and properly managed — without manual intervention.\u003C/p>\n\u003Cp>Want me to share the complete GitHub repository with all scripts? Let me know in the comments!\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Tags:\u003C/strong> #Intune #PowerShell #EndpointManager #ProactiveRemediation #ITPro\u003C/p>",{"headings":139,"localImagePaths":169,"remoteImagePaths":170,"frontmatter":171,"imagePaths":174},[140,142,145,148,151,154,157,160,163,166],{"depth":52,"slug":141,"text":127},"fix-stuck-intune-sync-the-ultimate-powershell-solution",{"depth":55,"slug":143,"text":144},"the-problem","The Problem",{"depth":55,"slug":146,"text":147},"the-solution-proactive-remediations","The Solution: Proactive Remediations",{"depth":62,"slug":149,"text":150},"step-1-create-the-detection-script","Step 1: Create the Detection Script",{"depth":62,"slug":152,"text":153},"step-2-create-the-remediation-script","Step 2: Create the Remediation Script",{"depth":62,"slug":155,"text":156},"step-3-deploy-in-intune","Step 3: Deploy in Intune",{"depth":62,"slug":158,"text":159},"step-4-validate","Step 4: Validate",{"depth":55,"slug":161,"text":162},"optional-log-analytics-integration","Optional: Log Analytics Integration",{"depth":55,"slug":164,"text":165},"user-experience","User Experience",{"depth":55,"slug":167,"text":168},"conclusion","Conclusion",[],[],{"title":127,"description":128,"pillar":37,"type":19,"tags":172,"difficulty":38,"publishedAt":16,"author":120,"heroImage":173,"featured":31},[40,21,130,131,132],"/images/intune-sync-fixer.png",[],"intune-stuck-sync-fixer.md","location-services-grayed-out-fix",{"id":176,"data":178,"body":185,"filePath":186,"digest":187,"rendered":188,"legacyId":238},{"title":179,"description":180,"publishedAt":16,"pillar":37,"difficulty":38,"type":19,"tags":181,"draft":25,"slug":26},"Fix Grayed Out Location Services in Intune","Troubleshoot and fix gray (disabled) Location Services settings on Windows devices managed by Microsoft Intune. Includes PowerShell solution.",[40,182,183,37,184],"location-services","windows","policy","# Fix Grayed Out Location Services in Intune\n\nAre Location Services grayed out on your Intune-managed devices? Can't users turn it on? This is a common issue with Windows devices provisioned via Autopilot. Here's the fix.\n\n## The Problem\n\nUsers see one of these messages:\n- *\"Location has been turned off by an admin on this device\"*\n- *\"Some of these settings are managed by your organization\"*\n\nAnd the toggles are disabled/grayed out.\n\n## Root Causes\n\nThere are two types of grayed out:\n\n### Type 1: \"Location has been turned off by an admin\"\nThis happens when:\n- Device was provisioned via Autopilot\n- OOBE privacy page was skipped\n- Location services are OFF by default\n- No Intune policy controls the setting\n\n### Type 2: \"Managed by your organization\"\nThis happens when:\n- You've configured Location Services settings via Intune, GPO, or registry\n\n## The Solution\n\n### Step 1: Enable Location Services via PowerShell\n\nThere's no Intune policy or GPO to enable Location Services. You need this command (run as System context):\n\n```powershell\n\"C:\\Windows\\system32\\SystemSettingsAdminFlows.exe\" SetCamSystemGlobal location 1\n```\n\nDeploy this via Intune as a PowerShell script running in System context.\n\n### Step 2: Configure Intune Settings Catalog\n\nIn Intune Settings Catalog, configure these settings:\n\n| Setting | Value |\n|---------|-------|\n| Turn off location (User) | Disabled |\n| Turn off sensors | Disabled |\n| Turn off sensors (User) | Disabled |\n\n### Step 3: Let Users Control App Permissions\n\nFor users to control which apps can access location:\n\n| Setting | Value |\n|---------|-------|\n| Let Apps Access Location | User in control |\n\nThis allows users to choose which apps can use location.\n\n## Complete Configuration Options\n\n### Option A: Force Allow All Apps\nIf you want ALL apps to access location:\n```\nLet Apps Access Location = Force deny\n```\n\n### Option B: Force Deny All Apps\nIf you want NO apps to access location:\n```\nLet Apps Access Location = Force deny\n```\n\n### Option C: User Control (Recommended)\nFor users to choose:\n1. Enable Location Services via PowerShell (Step 1)\n2. Set \"Let Apps Access Location\" = User in control\n\n## Verification\n\nAfter deployment, users should be able to:\n- See Location Services toggle available\n- Control \"Let apps access your location\"\n- Apps in Force Allow list work automatically\n- Users can add/remove other app permissions\n\n## Summary\n\n| Scenario | Solution |\n|----------|----------|\n| Location grayed out, no control | Run `SetCamSystemGlobal location 1` as System |\n| Want user control | Use \"User in control\" + enable service |\n| Force allow all apps | Set \"Let Apps Access Location\" = Force allow |\n| Force deny all apps | Set \"Let Apps Access Location\" = Force deny |\n\n---\n\n**Tags:** #Intune #Windows #LocationServices #Troubleshooting #ITPro","src/content/articles/location-services-grayed-out-fix.md","e5092d6c9e528afd",{"html":189,"metadata":190},"\u003Ch1 id=\"fix-grayed-out-location-services-in-intune\">Fix Grayed Out Location Services in Intune\u003C/h1>\n\u003Cp>Are Location Services grayed out on your Intune-managed devices? Can’t users turn it on? This is a common issue with Windows devices provisioned via Autopilot. Here’s the fix.\u003C/p>\n\u003Ch2 id=\"the-problem\">The Problem\u003C/h2>\n\u003Cp>Users see one of these messages:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cem>“Location has been turned off by an admin on this device”\u003C/em>\u003C/li>\n\u003Cli>\u003Cem>“Some of these settings are managed by your organization”\u003C/em>\u003C/li>\n\u003C/ul>\n\u003Cp>And the toggles are disabled/grayed out.\u003C/p>\n\u003Ch2 id=\"root-causes\">Root Causes\u003C/h2>\n\u003Cp>There are two types of grayed out:\u003C/p>\n\u003Ch3 id=\"type-1-location-has-been-turned-off-by-an-admin\">Type 1: “Location has been turned off by an admin”\u003C/h3>\n\u003Cp>This happens when:\u003C/p>\n\u003Cul>\n\u003Cli>Device was provisioned via Autopilot\u003C/li>\n\u003Cli>OOBE privacy page was skipped\u003C/li>\n\u003Cli>Location services are OFF by default\u003C/li>\n\u003Cli>No Intune policy controls the setting\u003C/li>\n\u003C/ul>\n\u003Ch3 id=\"type-2-managed-by-your-organization\">Type 2: “Managed by your organization”\u003C/h3>\n\u003Cp>This happens when:\u003C/p>\n\u003Cul>\n\u003Cli>You’ve configured Location Services settings via Intune, GPO, or registry\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"the-solution\">The Solution\u003C/h2>\n\u003Ch3 id=\"step-1-enable-location-services-via-powershell\">Step 1: Enable Location Services via PowerShell\u003C/h3>\n\u003Cp>There’s no Intune policy or GPO to enable Location Services. You need this command (run as System context):\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#9ECBFF\">\"C:\\Windows\\system32\\SystemSettingsAdminFlows.exe\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SetCamSystemGlobal location \u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Deploy this via Intune as a PowerShell script running in System context.\u003C/p>\n\u003Ch3 id=\"step-2-configure-intune-settings-catalog\">Step 2: Configure Intune Settings Catalog\u003C/h3>\n\u003Cp>In Intune Settings Catalog, configure these settings:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Setting\u003C/th>\u003Cth>Value\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Turn off location (User)\u003C/td>\u003Ctd>Disabled\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Turn off sensors\u003C/td>\u003Ctd>Disabled\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Turn off sensors (User)\u003C/td>\u003Ctd>Disabled\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch3 id=\"step-3-let-users-control-app-permissions\">Step 3: Let Users Control App Permissions\u003C/h3>\n\u003Cp>For users to control which apps can access location:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Setting\u003C/th>\u003Cth>Value\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Let Apps Access Location\u003C/td>\u003Ctd>User in control\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>This allows users to choose which apps can use location.\u003C/p>\n\u003Ch2 id=\"complete-configuration-options\">Complete Configuration Options\u003C/h2>\n\u003Ch3 id=\"option-a-force-allow-all-apps\">Option A: Force Allow All Apps\u003C/h3>\n\u003Cp>If you want ALL apps to access location:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Let Apps Access Location = Force deny\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"option-b-force-deny-all-apps\">Option B: Force Deny All Apps\u003C/h3>\n\u003Cp>If you want NO apps to access location:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Let Apps Access Location = Force deny\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"option-c-user-control-recommended\">Option C: User Control (Recommended)\u003C/h3>\n\u003Cp>For users to choose:\u003C/p>\n\u003Col>\n\u003Cli>Enable Location Services via PowerShell (Step 1)\u003C/li>\n\u003Cli>Set “Let Apps Access Location” = User in control\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"verification\">Verification\u003C/h2>\n\u003Cp>After deployment, users should be able to:\u003C/p>\n\u003Cul>\n\u003Cli>See Location Services toggle available\u003C/li>\n\u003Cli>Control “Let apps access your location”\u003C/li>\n\u003Cli>Apps in Force Allow list work automatically\u003C/li>\n\u003Cli>Users can add/remove other app permissions\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"summary\">Summary\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Solution\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Location grayed out, no control\u003C/td>\u003Ctd>Run \u003Ccode>SetCamSystemGlobal location 1\u003C/code> as System\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Want user control\u003C/td>\u003Ctd>Use “User in control” + enable service\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Force allow all apps\u003C/td>\u003Ctd>Set “Let Apps Access Location” = Force allow\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Force deny all apps\u003C/td>\u003Ctd>Set “Let Apps Access Location” = Force deny\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Cp>\u003Cstrong>Tags:\u003C/strong> #Intune #Windows #LocationServices #Troubleshooting #ITPro\u003C/p>",{"headings":191,"localImagePaths":232,"remoteImagePaths":233,"frontmatter":234,"imagePaths":237},[192,194,195,198,201,204,207,210,213,216,219,222,225,228,231],{"depth":52,"slug":193,"text":179},"fix-grayed-out-location-services-in-intune",{"depth":55,"slug":143,"text":144},{"depth":55,"slug":196,"text":197},"root-causes","Root Causes",{"depth":62,"slug":199,"text":200},"type-1-location-has-been-turned-off-by-an-admin","Type 1: “Location has been turned off by an admin”",{"depth":62,"slug":202,"text":203},"type-2-managed-by-your-organization","Type 2: “Managed by your organization”",{"depth":55,"slug":205,"text":206},"the-solution","The Solution",{"depth":62,"slug":208,"text":209},"step-1-enable-location-services-via-powershell","Step 1: Enable Location Services via PowerShell",{"depth":62,"slug":211,"text":212},"step-2-configure-intune-settings-catalog","Step 2: Configure Intune Settings Catalog",{"depth":62,"slug":214,"text":215},"step-3-let-users-control-app-permissions","Step 3: Let Users Control App Permissions",{"depth":55,"slug":217,"text":218},"complete-configuration-options","Complete Configuration Options",{"depth":62,"slug":220,"text":221},"option-a-force-allow-all-apps","Option A: Force Allow All Apps",{"depth":62,"slug":223,"text":224},"option-b-force-deny-all-apps","Option B: Force Deny All Apps",{"depth":62,"slug":226,"text":227},"option-c-user-control-recommended","Option C: User Control (Recommended)",{"depth":55,"slug":229,"text":230},"verification","Verification",{"depth":55,"slug":114,"text":115},[],[],{"title":179,"description":180,"pillar":37,"type":19,"tags":235,"difficulty":38,"publishedAt":16,"author":120,"heroImage":236,"featured":25},[40,182,183,37,184],"/images/location-services.png",[],"location-services-grayed-out-fix.md","powershell-win32-app-installers",{"id":239,"data":241,"body":247,"filePath":248,"digest":249,"rendered":250,"legacyId":302},{"title":242,"description":243,"publishedAt":16,"pillar":17,"difficulty":38,"type":19,"tags":244,"draft":25,"slug":26},"PowerShell Scripts as Win32 App Installers in Intune","Microsoft Intune now supports using PowerShell scripts directly as installers for Win32 apps. Learn how to use this powerful new feature.",[40,21,245,246,17],"win32","app-deployment","# PowerShell Scripts as Win32 App Installers in Intune\n\nBig news for Intune admins! Microsoft now supports using PowerShell scripts directly as installers for Win32 apps. This is a game-changer for dynamic installations. Let me show you how it works.\n\n## Why This Matters\n\nPreviously, deploying apps in Intune required:\n- Converting to `.intunewin` format\n- Using wrapper tools like Win32 Content Prep Tool\n- Complex detection rules\n\nNow? Just upload a PowerShell script and go!\n\n## The New Feature\n\nPowerShell scripts can now be used directly as installers, enabling:\n- **Dynamic installs** - Logic directly in the installer\n- **Conditional deployment** - Install based on system state\n- **Simpler packaging** - No more .intunewin conversion\n- **Better debugging** - Native PowerShell error handling\n\n## How to Configure\n\n### Step 1: Prepare Your PowerShell Script\n\nCreate your installer script. Example:\n\n```powershell\n# Check if app is already installed\n$appPath = \"C:\\Program Files\\MyApp\"\nif (Test-Path $appPath) {\n    Write-Output \"Application already installed\"\n    exit 0\n}\n\n# Download and install\n$installer = \"$env:TEMP\\myapp.exe\"\nInvoke-WebRequest -Uri \"https://example.com/myapp.exe\" -OutFile $installer\nStart-Process -FilePath $installer -ArgumentList \"/S\" -Wait\n\n# Verify installation\nif (Test-Path $appPath) {\n    Write-Output \"Installation successful\"\n    exit 0\n} else {\n    Write-Output \"Installation failed\"\n    exit 1\n}\n```\n\n### Step 2: Upload to Intune\n\n1. Go to **Microsoft Intune Admin Center**\n2. Navigate to **Apps → Windows**\nAdd3. Click **** → **Windows app (preview)**\n4. Select **PowerShell script** as installer type\n5. Upload your script\n\n### Step 3: Configure Detection Rule\n\n```powershell\n# Detection script\n$appPath = \"C:\\Program Files\\MyApp\"\nif (Test-Path $appPath) {\n    Write-Output \"Application is installed\"\n    exit 0\n}\nexit 1\n```\n\n### Step 4: Assign and Deploy\n\nAssign to user or device groups and deploy!\n\n## Use Cases\n\n### Use Case 1: Conditional Install\n```powershell\n# Only install if not present\nif (-not (Test-Path \"C:\\App\")) {\n    # Install logic\n}\n```\n\n### Use Case 2: Version Check\n```powershell\n$current = Get-ItemProperty -Path \"HKLM:\\SOFTWARE\\App\" -Name \"Version\" -ErrorAction SilentlyContinue\nif ($current.Version -lt \"2.0\") {\n    # Upgrade logic\n}\n```\n\n### Use Case 3: Environment Detection\n```powershell\nif ($env:COMPUTERNAME -like \"*-DEV*\") {\n    # Install dev tools\n} else {\n    # Install standard tools\n}\n```\n\n## Known Issues\n\n⚠️ **UI Bug Warning:** There's a known portal bug where navigating back and forth sometimes reverts to command line view instead of showing the PowerShell script. If this happens:\n- Do a hard refresh (Ctrl+F5)\n- Open app properties\n- Step back once, then re-enter\n\n## Benefits Summary\n\n| Before | After |\n|--------|-------|\n| Convert to .intunewin | Upload .ps1 directly |\n| Separate detection script | Built-in detection |\n| Complex tooling | Simple upload |\n| No dynamic logic | Full PowerShell |\n\n## Conclusion\n\nPowerShell as Win32 installers is a massive improvement for Intune app deployment. Less packaging, more dynamic control, simpler management.\n\nHave you tried this feature yet? Let me know in the comments!\n\n---\n\n**Tags:** #Intune #PowerShell #Win32 #AppDeployment #ITPro","src/content/articles/powershell-win32-app-installers.md","093c3e3ee6ce9c1b",{"html":251,"metadata":252},"\u003Ch1 id=\"powershell-scripts-as-win32-app-installers-in-intune\">PowerShell Scripts as Win32 App Installers in Intune\u003C/h1>\n\u003Cp>Big news for Intune admins! Microsoft now supports using PowerShell scripts directly as installers for Win32 apps. This is a game-changer for dynamic installations. Let me show you how it works.\u003C/p>\n\u003Ch2 id=\"why-this-matters\">Why This Matters\u003C/h2>\n\u003Cp>Previously, deploying apps in Intune required:\u003C/p>\n\u003Cul>\n\u003Cli>Converting to \u003Ccode>.intunewin\u003C/code> format\u003C/li>\n\u003Cli>Using wrapper tools like Win32 Content Prep Tool\u003C/li>\n\u003Cli>Complex detection rules\u003C/li>\n\u003C/ul>\n\u003Cp>Now? Just upload a PowerShell script and go!\u003C/p>\n\u003Ch2 id=\"the-new-feature\">The New Feature\u003C/h2>\n\u003Cp>PowerShell scripts can now be used directly as installers, enabling:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Dynamic installs\u003C/strong> - Logic directly in the installer\u003C/li>\n\u003Cli>\u003Cstrong>Conditional deployment\u003C/strong> - Install based on system state\u003C/li>\n\u003Cli>\u003Cstrong>Simpler packaging\u003C/strong> - No more .intunewin conversion\u003C/li>\n\u003Cli>\u003Cstrong>Better debugging\u003C/strong> - Native PowerShell error handling\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"how-to-configure\">How to Configure\u003C/h2>\n\u003Ch3 id=\"step-1-prepare-your-powershell-script\">Step 1: Prepare Your PowerShell Script\u003C/h3>\n\u003Cp>Create your installer script. Example:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Check if app is already installed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$appPath \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"C:\\Program Files\\MyApp\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Test-Path\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $appPath) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Application already installed\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Download and install\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$installer \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">$\u003C/span>\u003Cspan style=\"color:#79B8FF\">env:\u003C/span>\u003Cspan style=\"color:#E1E4E8\">TEMP\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\myapp.exe\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Invoke-WebRequest\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Uri \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"https://example.com/myapp.exe\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">OutFile $installer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">Start-Process\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">FilePath $installer \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#E1E4E8\">ArgumentList \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"/S\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Wait\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Verify installation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Test-Path\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $appPath) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Installation successful\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Installation failed\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-2-upload-to-intune\">Step 2: Upload to Intune\u003C/h3>\n\u003Col>\n\u003Cli>Go to \u003Cstrong>Microsoft Intune Admin Center\u003C/strong>\u003C/li>\n\u003Cli>Navigate to \u003Cstrong>Apps → Windows\u003C/strong>\nAdd3. Click **** → \u003Cstrong>Windows app (preview)\u003C/strong>\u003C/li>\n\u003Cli>Select \u003Cstrong>PowerShell script\u003C/strong> as installer type\u003C/li>\n\u003Cli>Upload your script\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"step-3-configure-detection-rule\">Step 3: Configure Detection Rule\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Detection script\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$appPath \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"C:\\Program Files\\MyApp\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Test-Path\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> $appPath) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Write-Output\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"Application is installed\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">exit\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"step-4-assign-and-deploy\">Step 4: Assign and Deploy\u003C/h3>\n\u003Cp>Assign to user or device groups and deploy!\u003C/p>\n\u003Ch2 id=\"use-cases\">Use Cases\u003C/h2>\n\u003Ch3 id=\"use-case-1-conditional-install\">Use Case 1: Conditional Install\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Only install if not present\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#F97583\">-not\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#79B8FF\">Test-Path\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"C:\\App\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    # Install logic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"use-case-2-version-check\">Use Case 2: Version Check\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">$current \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Get-ItemProperty\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Path \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"HKLM:\\SOFTWARE\\App\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Name \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Version\"\u003C/span>\u003Cspan style=\"color:#F97583\"> -\u003C/span>\u003Cspan style=\"color:#E1E4E8\">ErrorAction SilentlyContinue\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ($current.Version \u003C/span>\u003Cspan style=\"color:#F97583\">-lt\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"2.0\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    # Upgrade logic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"use-case-3-environment-detection\">Use Case 3: Environment Detection\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"powershell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ($\u003C/span>\u003Cspan style=\"color:#79B8FF\">env:\u003C/span>\u003Cspan style=\"color:#E1E4E8\">COMPUTERNAME \u003C/span>\u003Cspan style=\"color:#F97583\">-like\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> \"*-DEV*\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    # Install dev tools\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    # Install standard tools\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"known-issues\">Known Issues\u003C/h2>\n\u003Cp>⚠️ \u003Cstrong>UI Bug Warning:\u003C/strong> There’s a known portal bug where navigating back and forth sometimes reverts to command line view instead of showing the PowerShell script. If this happens:\u003C/p>\n\u003Cul>\n\u003Cli>Do a hard refresh (Ctrl+F5)\u003C/li>\n\u003Cli>Open app properties\u003C/li>\n\u003Cli>Step back once, then re-enter\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"benefits-summary\">Benefits Summary\u003C/h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Before\u003C/th>\u003Cth>After\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Convert to .intunewin\u003C/td>\u003Ctd>Upload .ps1 directly\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Separate detection script\u003C/td>\u003Ctd>Built-in detection\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Complex tooling\u003C/td>\u003Ctd>Simple upload\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>No dynamic logic\u003C/td>\u003Ctd>Full PowerShell\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>PowerShell as Win32 installers is a massive improvement for Intune app deployment. Less packaging, more dynamic control, simpler management.\u003C/p>\n\u003Cp>Have you tried this feature yet? Let me know in the comments!\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Tags:\u003C/strong> #Intune #PowerShell #Win32 #AppDeployment #ITPro\u003C/p>",{"headings":253,"localImagePaths":296,"remoteImagePaths":297,"frontmatter":298,"imagePaths":301},[254,256,259,262,265,268,271,274,277,280,283,286,289,292,295],{"depth":52,"slug":255,"text":242},"powershell-scripts-as-win32-app-installers-in-intune",{"depth":55,"slug":257,"text":258},"why-this-matters","Why This Matters",{"depth":55,"slug":260,"text":261},"the-new-feature","The New Feature",{"depth":55,"slug":263,"text":264},"how-to-configure","How to Configure",{"depth":62,"slug":266,"text":267},"step-1-prepare-your-powershell-script","Step 1: Prepare Your PowerShell Script",{"depth":62,"slug":269,"text":270},"step-2-upload-to-intune","Step 2: Upload to Intune",{"depth":62,"slug":272,"text":273},"step-3-configure-detection-rule","Step 3: Configure Detection Rule",{"depth":62,"slug":275,"text":276},"step-4-assign-and-deploy","Step 4: Assign and Deploy",{"depth":55,"slug":278,"text":279},"use-cases","Use Cases",{"depth":62,"slug":281,"text":282},"use-case-1-conditional-install","Use Case 1: Conditional Install",{"depth":62,"slug":284,"text":285},"use-case-2-version-check","Use Case 2: Version Check",{"depth":62,"slug":287,"text":288},"use-case-3-environment-detection","Use Case 3: Environment Detection",{"depth":55,"slug":290,"text":291},"known-issues","Known Issues",{"depth":55,"slug":293,"text":294},"benefits-summary","Benefits Summary",{"depth":55,"slug":167,"text":168},[],[],{"title":242,"description":243,"pillar":17,"type":19,"tags":299,"difficulty":38,"publishedAt":16,"author":120,"heroImage":300,"featured":31},[40,21,245,246,17],"/images/powershell-win32.png",[],"powershell-win32-app-installers.md","windows-first-signin-restore-fix",{"id":303,"data":305,"body":312,"filePath":313,"digest":314,"rendered":315,"legacyId":350},{"title":306,"description":307,"publishedAt":16,"pillar":37,"difficulty":38,"type":19,"tags":308,"draft":25,"slug":26},"Fix Windows First Sign-in Restore: Conditional Access Fix","Troubleshooting Windows First Sign-in Restore failing during Autopilot due to Conditional Access policies blocking the Microsoft Activity Feed Service.",[309,310,183,40,37,311],"autopilot","conditional-access","deployment","# Fix Windows First Sign-in Restore: Conditional Access Fix\n\nWindows First Sign-in Restore is a powerful feature that lets users restore their apps and settings during Autopilot. But if you're using Conditional Access to enforce compliant devices, you might hit a frustrating error that breaks the entire experience.\n\n## The Error\n\nDuring Autopilot, users see this alarming message:\n\n> *\"You can't get there from here. This application contains sensitive information and can only be accessed from devices or client applications that meet management compliance policy.\"*\n\nThe only option is \"OK\" — which loops back to a \"Try again\" button with the infamous ice cream cone.\n\n## Root Cause\n\nThe issue is a **Conditional Access chicken-and-egg problem**:\n\n1. First Sign-in Restore communicates with the **Microsoft Activity Feed Service** (App ID: `d32c68ad-72d2-4acb-a0c7-46bb2cf93873`)\n2. During OOBE/Autopilot, the device **hasn't reported compliance yet**\n3. Your CA policy requires a compliant device → **Blocks the restore**\n\nIn Sign-in logs, you'll see:\n- **Error code:** 53000\n- **Failure reason:** \"Device is not in required device state\"\n- **Application:** Windows Backup and Restore\n- **Resource:** Microsoft Activity Feed Service\n\n## The Fix\n\nExclude the **Microsoft Activity Feed Service** from your Conditional Access policy:\n\n### Step 1: Identify the CA Policy\n\n1. Open **Microsoft Entra admin center**\n2. Go to **Protect → Conditional Access**\n3. Find policies that enforce \"Require compliant device\"\n\n### Step 2: Add Exception\n\n1. Edit the policy\n2. Go to **Assignments → Exclude**\n3. Click **Select users and workloads**\n4. Add **Cloud apps** exclusion\n5. Search for: **Microsoft Activity Feed Service**\n6. Save and test\n\n### Step 3: Verify\n\nAfter the exclusion:\n- Autopilot flows normally\n- First Sign-in Restore page appears as expected\n- Users complete setup without errors\n\n## What to Check\n\nIf you're enabling Windows First Sign-in Restore with strict CA:\n\n| Check | Action |\n|-------|--------|\n| Sign-in logs | Look for Windows Backup and Restore failures |\n| Error code 53000 | Means CA blocked due to non-compliant device |\n| CA policy | Add exclusion for Microsoft Activity Feed Service |\n\n## Why This Happens\n\nIt's the same problem as other foundational services:\n- Enrollment\n- Device registration\n- Azure AD join\n\nThese all need CA exclusions because the device isn't compliant YET — but it will be after Autopilot completes.\n\n## Conclusion\n\nDon't let Conditional Access break your Autopilot experience. Add the Microsoft Activity Feed Service exclusion, and your users will enjoy a seamless restore experience.\n\n---\n\n**Tags:** #Windows #Autopilot #ConditionalAccess #Intune #ITPro #Troubleshooting","src/content/articles/windows-first-signin-restore-fix.md","cabe1b95edbbec0a",{"html":316,"metadata":317},"\u003Ch1 id=\"fix-windows-first-sign-in-restore-conditional-access-fix\">Fix Windows First Sign-in Restore: Conditional Access Fix\u003C/h1>\n\u003Cp>Windows First Sign-in Restore is a powerful feature that lets users restore their apps and settings during Autopilot. But if you’re using Conditional Access to enforce compliant devices, you might hit a frustrating error that breaks the entire experience.\u003C/p>\n\u003Ch2 id=\"the-error\">The Error\u003C/h2>\n\u003Cp>During Autopilot, users see this alarming message:\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cem>“You can’t get there from here. This application contains sensitive information and can only be accessed from devices or client applications that meet management compliance policy.”\u003C/em>\u003C/p>\n\u003C/blockquote>\n\u003Cp>The only option is “OK” — which loops back to a “Try again” button with the infamous ice cream cone.\u003C/p>\n\u003Ch2 id=\"root-cause\">Root Cause\u003C/h2>\n\u003Cp>The issue is a \u003Cstrong>Conditional Access chicken-and-egg problem\u003C/strong>:\u003C/p>\n\u003Col>\n\u003Cli>First Sign-in Restore communicates with the \u003Cstrong>Microsoft Activity Feed Service\u003C/strong> (App ID: \u003Ccode>d32c68ad-72d2-4acb-a0c7-46bb2cf93873\u003C/code>)\u003C/li>\n\u003Cli>During OOBE/Autopilot, the device \u003Cstrong>hasn’t reported compliance yet\u003C/strong>\u003C/li>\n\u003Cli>Your CA policy requires a compliant device → \u003Cstrong>Blocks the restore\u003C/strong>\u003C/li>\n\u003C/ol>\n\u003Cp>In Sign-in logs, you’ll see:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Error code:\u003C/strong> 53000\u003C/li>\n\u003Cli>\u003Cstrong>Failure reason:\u003C/strong> “Device is not in required device state”\u003C/li>\n\u003Cli>\u003Cstrong>Application:\u003C/strong> Windows Backup and Restore\u003C/li>\n\u003Cli>\u003Cstrong>Resource:\u003C/strong> Microsoft Activity Feed Service\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"the-fix\">The Fix\u003C/h2>\n\u003Cp>Exclude the \u003Cstrong>Microsoft Activity Feed Service\u003C/strong> from your Conditional Access policy:\u003C/p>\n\u003Ch3 id=\"step-1-identify-the-ca-policy\">Step 1: Identify the CA Policy\u003C/h3>\n\u003Col>\n\u003Cli>Open \u003Cstrong>Microsoft Entra admin center\u003C/strong>\u003C/li>\n\u003Cli>Go to \u003Cstrong>Protect → Conditional Access\u003C/strong>\u003C/li>\n\u003Cli>Find policies that enforce “Require compliant device”\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"step-2-add-exception\">Step 2: Add Exception\u003C/h3>\n\u003Col>\n\u003Cli>Edit the policy\u003C/li>\n\u003Cli>Go to \u003Cstrong>Assignments → Exclude\u003C/strong>\u003C/li>\n\u003Cli>Click \u003Cstrong>Select users and workloads\u003C/strong>\u003C/li>\n\u003Cli>Add \u003Cstrong>Cloud apps\u003C/strong> exclusion\u003C/li>\n\u003Cli>Search for: \u003Cstrong>Microsoft Activity Feed Service\u003C/strong>\u003C/li>\n\u003Cli>Save and test\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"step-3-verify\">Step 3: Verify\u003C/h3>\n\u003Cp>After the exclusion:\u003C/p>\n\u003Cul>\n\u003Cli>Autopilot flows normally\u003C/li>\n\u003Cli>First Sign-in Restore page appears as expected\u003C/li>\n\u003Cli>Users complete setup without errors\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"what-to-check\">What to Check\u003C/h2>\n\u003Cp>If you’re enabling Windows First Sign-in Restore with strict CA:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Check\u003C/th>\u003Cth>Action\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Sign-in logs\u003C/td>\u003Ctd>Look for Windows Backup and Restore failures\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Error code 53000\u003C/td>\u003Ctd>Means CA blocked due to non-compliant device\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>CA policy\u003C/td>\u003Ctd>Add exclusion for Microsoft Activity Feed Service\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Ch2 id=\"why-this-happens\">Why This Happens\u003C/h2>\n\u003Cp>It’s the same problem as other foundational services:\u003C/p>\n\u003Cul>\n\u003Cli>Enrollment\u003C/li>\n\u003Cli>Device registration\u003C/li>\n\u003Cli>Azure AD join\u003C/li>\n\u003C/ul>\n\u003Cp>These all need CA exclusions because the device isn’t compliant YET — but it will be after Autopilot completes.\u003C/p>\n\u003Ch2 id=\"conclusion\">Conclusion\u003C/h2>\n\u003Cp>Don’t let Conditional Access break your Autopilot experience. Add the Microsoft Activity Feed Service exclusion, and your users will enjoy a seamless restore experience.\u003C/p>\n\u003Chr>\n\u003Cp>\u003Cstrong>Tags:\u003C/strong> #Windows #Autopilot #ConditionalAccess #Intune #ITPro #Troubleshooting\u003C/p>",{"headings":318,"localImagePaths":344,"remoteImagePaths":345,"frontmatter":346,"imagePaths":349},[319,321,322,325,328,331,334,337,340,343],{"depth":52,"slug":320,"text":306},"fix-windows-first-sign-in-restore-conditional-access-fix",{"depth":55,"slug":56,"text":57},{"depth":55,"slug":323,"text":324},"root-cause","Root Cause",{"depth":55,"slug":326,"text":327},"the-fix","The Fix",{"depth":62,"slug":329,"text":330},"step-1-identify-the-ca-policy","Step 1: Identify the CA Policy",{"depth":62,"slug":332,"text":333},"step-2-add-exception","Step 2: Add Exception",{"depth":62,"slug":335,"text":336},"step-3-verify","Step 3: Verify",{"depth":55,"slug":338,"text":339},"what-to-check","What to Check",{"depth":55,"slug":341,"text":342},"why-this-happens","Why This Happens",{"depth":55,"slug":167,"text":168},[],[],{"title":306,"description":307,"pillar":37,"type":19,"tags":347,"difficulty":38,"publishedAt":16,"author":120,"heroImage":348,"featured":31},[309,310,183,40,37,311],"/images/first-signin-restore.png",[],"windows-first-signin-restore-fix.md","scripts",["Map",353,354],"remove-old-user-profiles",{"id":353,"data":355,"body":358,"filePath":359,"digest":360,"legacyId":361,"deferredRender":31},{"title":356,"description":357,"language":21,"pillar":17,"publishedAt":16,"draft":25,"slug":26},"Remove Old User Profiles","PowerShell script to remove stale user profiles from Windows machines.","# Remove Old User Profiles\n\nThis script removes user profiles older than a specified number of days from Windows machines.\n\n## Usage\n\n```powershell\n.\\Remove-OldProfiles.ps1 -DaysOld 90 -WhatIf\n```\n\n## Parameters\n\n- **DaysOld**: Number of days since last logon (default: 90)\n- **WhatIf**: Preview what would be deleted without actually deleting\n- **Force**: Skip confirmation prompts\n\n## Script\n\n```powershell\n\u003C#\n.SYNOPSIS\n    Remove old user profiles from Windows machines.\n    \n.DESCRIPTION\n    This script removes user profiles that haven't been logged into for a specified number of days.\n    Supports -WhatIf mode for safe testing.\n    \n.PARAMETER DaysOld\n    Number of days since last logon (default: 90)\n    \n.PARAMETER WhatIf\n    Preview what would be deleted without actually deleting\n    \n.PARAMETER Force\n    Skip confirmation prompts\n    \n.EXAMPLE\n    .\\Remove-OldProfiles.ps1 -DaysOld 90 -WhatIf\n    \n.EXAMPLE\n    .\\Remove-OldProfiles.ps1 -DaysOld 60 -Force\n#>\n\n[CmdletBinding(SupportsShouldProcess)]\nparam(\n    [Parameter(Mandatory=$false)]\n    [int]$DaysOld = 90,\n    \n    [Parameter(Mandatory=$false)]\n    [switch]$Force\n)\n\n$LogFile = \"$env:TEMP\\ProfileCleanup_$(Get-Date -Format 'yyyyMMdd_HHmmss').log\"\n\nfunction Write-Log {\n    param([string]$Message)\n    $Timestamp = Get-Date -Format 'yyyy-MM-dd HH:mm:ss'\n    $LogMessage = \"[$Timestamp] $Message\"\n    Write-Host $LogMessage\n    Add-Content -Path $LogFile -Value $LogMessage\n}\n\nWrite-Log \"Starting profile cleanup. DaysOld: $DaysOld\"\n\n# Get all user profiles\n$Profiles = Get-CimInstance -ClassName Win32_UserProfile | \n    Where-Object { $_.LocalPath -notmatch '^(C:|D:|E:|F:)\\\\Users\\\\(Public|Default|Administrator|System)' }\n\n$CutoffDate = (Get-Date).AddDays(-$DaysOld)\n$ToDelete = @()\n\nforeach ($Profile in $Profiles) {\n    $LastUse = $Profile.LastUseTime\n    $Username = $Profile.LocalPath -replace '.*\\\\', ''\n    \n    if ($LastUse -and $LastUse -lt $CutoffDate) {\n        $ToDelete += [PSCustomObject]@{\n            Username = $Username\n            LastUsed = $LastUse\n            Path = $Profile.LocalPath\n            DaysSince = ((Get-Date) - $LastUse).Days\n        }\n    }\n}\n\nif ($ToDelete.Count -eq 0) {\n    Write-Log \"No profiles older than $DaysOld days found.\"\n    exit 0\n}\n\nWrite-Log \"Found $($ToDelete.Count) profiles to remove:\"\n$ToDelete | ForEach-Object { Write-Log \"  - $($_.Username) (last used: $($_.LastUsed), $($_.DaysSince) days ago)\" }\n\nif ($WhatIfPreference -or $PSCmdlet.ShouldProcess(\"Delete $($ToDelete.Count) profiles\")) {\n    if ($Force -or $PSCmdlet.ShouldContinue(\"Delete $($ToDelete.Count) old profiles?\", \"Confirm Deletion\")) {\n        foreach ($Profile in $ToDelete) {\n            try {\n                # Remove the profile using WMI\n                $Profile | Remove-CimInstance -ErrorAction Stop\n                Write-Log \"DELETED: $($Profile.Username)\"\n            }\n            catch {\n                Write-Log \"ERROR deleting $($Profile.Username): $_\"\n            }\n        }\n    }\n}\n\nWrite-Log \"Profile cleanup complete. Log saved to: $LogFile\"\n```\n\n## Important Notes\n\n1. **Always run with -WhatIf first** to see what will be deleted\n2. **Excluded accounts**: Public, Default, Administrator, System profiles are always preserved\n3. **Requires admin rights** to delete profiles\n4. **Logged actions** are saved to a log file in TEMP\n\n## Automation\n\nTo run as a scheduled task:\n\n```powershell\n$Action = New-ScheduledTaskAction -Execute 'Powershell.exe' -Argument '-NoProfile -ExecutionPolicy Bypass -File C:\\Scripts\\Remove-OldProfiles.ps1 -DaysOld 90 -Force'\n$Trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek Sunday -At 3AM\nRegister-ScheduledTask -TaskName 'Cleanup Old Profiles' -Action $Action -Trigger $Trigger -RunLevel Highest\n```","src/content/scripts/remove-old-user-profiles.mdx","fd43cc79e5219c55","remove-old-user-profiles.mdx","series",["Map",364,365],"windows-startup-repair",{"id":364,"data":366,"body":373,"filePath":374,"digest":375,"rendered":376,"legacyId":388},{"name":367,"description":368,"pillar":37,"difficulty":38,"tags":369,"draft":25},"Windows Startup Repair Masterclass","A comprehensive multi-part series on diagnosing and fixing Windows boot and startup issues from common errors to advanced recovery techniques.",[183,370,371,372,37],"startup","repair","boot","This is a placeholder for the series. Articles in this series will be automatically grouped here.\n\n## Coming Soon\n- Part 1: Understanding the Windows Boot Process\n- Part 2: Common Startup Errors and What They Mean\n- Part 3: Using Windows Startup Repair\n- Part 4: Advanced Boot Options\n- Part 5: BCD Rebuilding Deep Dive\n- Part 6: System Restore Points\n- Part 7: Safe Mode Troubleshooting\n- Part 8: When to Use System Image Recovery","src/content/series/windows-startup-repair.md","eaa9857553328ffb",{"html":377,"metadata":378},"\u003Cp>This is a placeholder for the series. Articles in this series will be automatically grouped here.\u003C/p>\n\u003Ch2 id=\"coming-soon\">Coming Soon\u003C/h2>\n\u003Cul>\n\u003Cli>Part 1: Understanding the Windows Boot Process\u003C/li>\n\u003Cli>Part 2: Common Startup Errors and What They Mean\u003C/li>\n\u003Cli>Part 3: Using Windows Startup Repair\u003C/li>\n\u003Cli>Part 4: Advanced Boot Options\u003C/li>\n\u003Cli>Part 5: BCD Rebuilding Deep Dive\u003C/li>\n\u003Cli>Part 6: System Restore Points\u003C/li>\n\u003Cli>Part 7: Safe Mode Troubleshooting\u003C/li>\n\u003Cli>Part 8: When to Use System Image Recovery\u003C/li>\n\u003C/ul>",{"headings":379,"localImagePaths":383,"remoteImagePaths":384,"frontmatter":385,"imagePaths":387},[380],{"depth":55,"slug":381,"text":382},"coming-soon","Coming Soon",[],[],{"name":367,"description":368,"pillar":37,"difficulty":38,"tags":386,"draft":25},[183,370,371,372,37],[],"windows-startup-repair.md"]